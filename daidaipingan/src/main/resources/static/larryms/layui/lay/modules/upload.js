layui.define("layer",function(e){"use strict";var h=layui.$,i=layui.layer,t=layui.hint(),v=layui.device(),n={config:{},set:function(e){var i=this;return i.config=h.extend({},i.config,e),i},on:function(e,i){return layui.onevent.call(this,o,e,i)}},a=function(){var i=this;return{upload:function(e){i.upload.call(i,e)},config:i.config}},o="upload",l="layui-upload-file",r="layui-upload-form",g="layui-upload-iframe",y="layui-upload-choose",F=function(e){var i=this;i.config=h.extend({},i.config,n.config,e),i.render()};F.prototype.config={accept:"images",exts:"",auto:!0,bindAction:"",url:"",field:"file",method:"post",data:{},drag:!0,size:0,number:0,multiple:!1},F.prototype.render=function(e){var i=this,e=i.config;e.elem=h(e.elem),e.bindAction=h(e.bindAction),i.file(),i.events()},F.prototype.file=function(){var e=this,i=e.config,t=e.elemFile=h(['<input class="'+l+'" type="file" accept="'+i.acceptMime+'" name="'+i.field+'"',i.multiple?" multiple":"",">"].join("")),n=i.elem.next();(n.hasClass(l)||n.hasClass(r))&&n.remove(),v.ie&&v.ie<10&&i.elem.wrap('<div class="layui-upload-wrap"></div>'),e.isFile()?(e.elemFile=i.elem,i.field=i.elem[0].name):i.elem.after(t),v.ie&&v.ie<10&&e.initIE()},F.prototype.initIE=function(){var e=this,i=e.config,t=h('<iframe id="'+g+'" class="'+g+'" name="'+g+'" frameborder="0"></iframe>'),n=h(['<form target="'+g+'" class="'+r+'" method="post" key="set-mine" enctype="multipart/form-data" action="'+i.url+'">',"</form>"].join(""));h("#"+g)[0]||h("body").append(t),i.elem.next().hasClass(r)||(e.elemFile.wrap(n),i.elem.next("."+r).append(function(){var t=[];return layui.each(i.data,function(e,i){i="function"==typeof i?i():i,t.push('<input type="hidden" name="'+e+'" value="'+i+'">')}),t.join("")}()))},F.prototype.msg=function(e){return i.msg(e,{icon:2,shift:6})},F.prototype.isFile=function(){var e=this.config.elem[0];if(e)return"input"===e.tagName.toLocaleLowerCase()&&"file"===e.type},F.prototype.preview=function(n){var e=this;window.FileReader&&layui.each(e.chooseFiles,function(e,i){var t=new FileReader;t.readAsDataURL(i),t.onload=function(){n&&n(e,i,this.result)}})},F.prototype.upload=function(l,e){var t,r=this,u=r.config,c=r.elemFile[0],i=function(){var n=0,a=0,e=l||r.files||r.chooseFiles||c.files,o=function(){u.multiple&&n+a===r.fileLength&&"function"==typeof u.allDone&&u.allDone({total:r.fileLength,successful:n,aborted:a})};layui.each(e,function(i,e){var t=new FormData;t.append(u.field,e),layui.each(u.data,function(e,i){i="function"==typeof i?i():i,t.append(e,i)}),h.ajax({url:u.url,type:"post",data:t,contentType:!1,processData:!1,dataType:"json",headers:u.headers||{},success:function(e){n++,f(i,e),o()},error:function(){a++,r.msg("请求上传接口出现异常"),s(i),o()}})})},n=function(){var t=h("#"+g);r.elemFile.parent().submit(),clearInterval(F.timer),F.timer=setInterval(function(){var e,i=t.contents().find("body");try{e=i.text()}catch(e){r.msg("获取上传后的响应信息出现异常"),clearInterval(F.timer),s()}e&&(clearInterval(F.timer),i.html(""),f(0,e))},30)},f=function(e,i){if(r.elemFile.next("."+y).remove(),c.value="","object"!=typeof i)try{i=JSON.parse(i)}catch(e){return i={},r.msg("请对上传接口返回有效JSON")}"function"==typeof u.done&&u.done(i,e||0,function(e){r.upload(e)})},s=function(e){u.auto&&(c.value=""),"function"==typeof u.error&&u.error(e||0,function(e){r.upload(e)})},a=u.exts,o=function(){var t=[];return layui.each(l||r.chooseFiles,function(e,i){t.push(i.name)}),t}(),p={preview:function(e){r.preview(e)},upload:function(e,i){var t={};t[e]=i,r.upload(t)},pushFile:function(){return r.files=r.files||{},layui.each(r.chooseFiles,function(e,i){r.files[e]=i}),r.files},resetFile:function(e,i,t){var n=new File([i],t);r.files=r.files||{},r.files[e]=n}},d=function(){if("choose"!==e&&!u.auto||(u.choose&&u.choose(p),"choose"!==e))return u.before&&u.before(p),v.ie?v.ie>9?i():n():void i()};if(o=0===o.length?c.value.match(/[^\/\\]+\..+/g)||[]||"":o,0!==o.length){switch(u.accept){case"file":if(a&&!RegExp("\\w\\.("+a+")$","i").test(escape(o)))return r.msg("选择的文件中包含不支持的格式"),c.value="";break;case"video":if(!RegExp("\\w\\.("+(a||"avi|mp4|wma|rmvb|rm|flash|3gp|flv")+")$","i").test(escape(o)))return r.msg("选择的视频中包含不支持的格式"),c.value="";break;case"audio":if(!RegExp("\\w\\.("+(a||"mp3|wav|mid")+")$","i").test(escape(o)))return r.msg("选择的音频中包含不支持的格式"),c.value="";break;default:if(layui.each(o,function(e,i){RegExp("\\w\\.("+(a||"jpg|png|gif|bmp|jpeg$")+")","i").test(escape(i))||(t=!0)}),t)return r.msg("选择的图片中包含不支持的格式"),c.value=""}if(r.fileLength=function(){var e=0,i=l||r.files||r.chooseFiles||c.files;return layui.each(i,function(){e++}),e}(),u.number&&r.fileLength>u.number)return r.msg("同时最多只能上传的数量为："+u.number);if(u.size>0&&!(v.ie&&v.ie<10)){var m;if(layui.each(r.chooseFiles,function(e,i){if(i.size>1024*u.size){var t=u.size/1024;t=t>=1?t.toFixed(2)+"MB":u.size+"KB",c.value="",m=t}}),m)return r.msg("文件不能超过"+m)}d()}},F.prototype.events=function(){var a=this,o=a.config,l=function(e){a.chooseFiles={},layui.each(e,function(e,i){var t=(new Date).getTime();a.chooseFiles[t+"-"+e]=i})},r=function(e,i){var t=a.elemFile,n=e.length>1?e.length+"个文件":(e[0]||{}).name||t[0].value.match(/[^\/\\]+\..+/g)||[]||"";t.next().hasClass(y)&&t.next().remove(),a.upload(null,"choose"),a.isFile()||o.choose||t.after('<span class="layui-inline '+y+'">'+n+"</span>")};o.elem.off("upload.start").on("upload.start",function(){var e=h(this),i=e.attr("lay-data");if(i)try{i=new Function("return "+i)(),a.config=h.extend({},o,i)}catch(e){t.error("Upload element property lay-data configuration item has a syntax error: "+i)}a.config.item=e,a.elemFile[0].click()}),v.ie&&v.ie<10||o.elem.off("upload.over").on("upload.over",function(){var e=h(this);e.attr("lay-over","")}).off("upload.leave").on("upload.leave",function(){var e=h(this);e.removeAttr("lay-over")}).off("upload.drop").on("upload.drop",function(e,i){var t=h(this),n=i.originalEvent.dataTransfer.files||[];t.removeAttr("lay-over"),l(n),o.auto?a.upload(n):r(n)}),a.elemFile.off("upload.change").on("upload.change",function(){var e=this.files||[];l(e),o.auto?a.upload():r(e)}),o.bindAction.off("upload.action").on("upload.action",function(){a.upload()}),o.elem.data("haveEvents")||(a.elemFile.on("change",function(){h(this).trigger("upload.change")}),o.elem.on("click",function(){a.isFile()||h(this).trigger("upload.start")}),o.drag&&o.elem.on("dragover",function(e){e.preventDefault(),h(this).trigger("upload.over")}).on("dragleave",function(e){h(this).trigger("upload.leave")}).on("drop",function(e){e.preventDefault(),h(this).trigger("upload.drop",e)}),o.bindAction.on("click",function(){h(this).trigger("upload.action")}),o.elem.data("haveEvents",!0))},n.render=function(e){var i=new F(e);return a.call(i)},e(o,n)});