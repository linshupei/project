layui.define(["layer","form"],function(t){"use strict";var d=layui.$,u=layui.layer,n=layui.form,y=(layui.hint(),layui.device()),i="layedit",f="layui-show",m="layui-disabled",e=function(){var t=this;t.index=0,t.config={tool:["strong","italic","underline","del","|","left","center","right","|","link","unlink","face","image"],hideTool:[],height:280}};e.prototype.set=function(t){var e=this;return d.extend(!0,e.config,t),e},e.prototype.on=function(t,e){return layui.onevent(i,t,e)},e.prototype.build=function(t,e){e=e||{};var i=this,a=i.config,l="layui-layedit",n=d("string"==typeof t?"#"+t:t),o="LAY_layedit_"+ ++i.index,r=n.next("."+l),c=d.extend({},a,e),s=function(){var i=[],a={};return layui.each(c.hideTool,function(t,e){a[e]=!0}),layui.each(c.tool,function(t,e){T[e]&&!a[e]&&i.push(T[e])}),i.join("")}(),u=d(['<div class="'+l+'">','<div class="layui-unselect layui-layedit-tool">'+s+"</div>",'<div class="layui-layedit-iframe">','<iframe id="'+o+'" name="'+o+'" textarea="'+t+'" frameborder="0"></iframe>',"</div>","</div>"].join(""));return y.ie&&y.ie<8?n.removeClass("layui-hide").addClass(f):(r[0]&&r.remove(),p.call(i,u,n[0],c),n.addClass("layui-hide").after(u),i.index)},e.prototype.getContent=function(t){var e=l(t);if(e[0])return a(e[0].document.body.innerHTML)},e.prototype.getText=function(t){var e=l(t);if(e[0])return d(e[0].document.body).text()},e.prototype.setContent=function(t,e,i){var a=l(t);a[0]&&(i?d(a[0].document.body).append(e):d(a[0].document.body).html(e),layedit.sync(t))},e.prototype.sync=function(t){var e=l(t);if(e[0]){var i=d("#"+e[1].attr("textarea"));i.val(a(e[0].document.body.innerHTML))}},e.prototype.getSelection=function(t){var e=l(t);if(e[0]){var i=h(e[0].document);return document.selection?i.text:i.toString()}};var p=function(n,o,r){var c=this,s=n.find("iframe");s.css({height:r.height}).on("load",function(){var t=s.contents(),e=s.prop("contentWindow"),i=t.find("head"),a=d(["<style>","*{margin: 0; padding: 0;}","body{padding: 10px; line-height: 20px; overflow-x: hidden; word-wrap: break-word; font: 14px Helvetica Neue,Helvetica,PingFang SC,Microsoft YaHei,Tahoma,Arial,sans-serif; -webkit-box-sizing: border-box !important; -moz-box-sizing: border-box !important; box-sizing: border-box !important;}","a{color:#01AAED; text-decoration:none;}a:hover{color:#c00}","p{margin-bottom: 10px;}","img{display: inline-block; border: none; vertical-align: middle;}","pre{margin: 10px 0; padding: 10px; line-height: 20px; border: 1px solid #ddd; border-left-width: 6px; background-color: #F2F2F2; color: #333; font-family: Courier New; font-size: 12px;}","</style>"].join("")),l=t.find("body");i.append(a),l.attr("contenteditable","true").css({"min-height":r.height}).html(o.value||""),v.apply(c,[e,s,o,r]),k.call(c,e,n,r)})},l=function(t){var e=d("#LAY_layedit_"+t),i=e.prop("contentWindow");return[i,e]},a=function(t){return 8==y.ie&&(t=t.replace(/<.+>/g,function(t){return t.toLowerCase()})),t},v=function(e,t,i,a){var n=e.document,l=d(n.body);l.on("keydown",function(t){var e=t.keyCode;if(13===e){var i=h(n),a=g(i),l=a.parentNode;if("pre"===l.tagName.toLowerCase()){if(t.shiftKey)return;return u.msg("请暂时用shift+enter"),!1}n.execCommand("formatBlock",!1,"<p>")}}),d(i).parents("form").on("submit",function(){var t=l.html();8==y.ie&&(t=t.replace(/<.+>/g,function(t){return t.toLowerCase()})),i.value=t}),l.on("paste",function(t){n.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){o.call(e,l),i.value=l.html()},100)})},o=function(t){var e=this;e.document;t.find("*[style]").each(function(){var t=this.style.textAlign;this.removeAttribute("style"),d(this).css({"text-align":t||""})}),t.find("table").addClass("layui-table"),t.find("script,link").remove()},h=function(t){return t.selection?t.selection.createRange():t.getSelection().getRangeAt(0)},g=function(t){return t.endContainer||t.parentElement().childNodes[0]},b=function(t,e,i){var a=this.document,l=document.createElement(t);for(var n in e)l.setAttribute(n,e[n]);if(l.removeAttribute("text"),a.selection){var o=i.text||e.text;if("a"===t&&!o)return;o&&(l.innerHTML=o),i.pasteHTML(d(l).prop("outerHTML")),i.select()}else{var o=i.toString()||e.text;if("a"===t&&!o)return;o&&(l.innerHTML=o),i.deleteContents(),i.insertNode(l)}},x=function(e,t){var i=this.document,a="layedit-tool-active",l=g(h(i)),n=function(t){return e.find(".layedit-tool-"+t)};t&&t[t.hasClass(a)?"removeClass":"addClass"](a),e.find(">i").removeClass(a),n("unlink").addClass(m),d(l).parents().each(function(){var t=this.tagName.toLowerCase(),e=this.style.textAlign;"b"!==t&&"strong"!==t||n("b").addClass(a),"i"!==t&&"em"!==t||n("i").addClass(a),"u"===t&&n("u").addClass(a),"strike"===t&&n("d").addClass(a),"p"===t&&("center"===e?n("center").addClass(a):"right"===e?n("right").addClass(a):n("left").addClass(a)),"a"===t&&(n("link").addClass(a),n("unlink").removeClass(m))})},k=function(l,t,n){var o=l.document,r=d(o.body),c={link:function(i){var t=g(i),a=d(t).parent();C.call(r,{href:a.attr("href"),target:a.attr("target")},function(t){var e=a[0];"A"===e.tagName?e.href=t.url:b.call(l,"a",{target:t.target,href:t.url,text:t.url},i)})},unlink:function(t){o.execCommand("unlink")},face:function(e){w.call(this,function(t){b.call(l,"img",{src:t.src,alt:t.alt},e)})},image:function(i){var a=this;layui.use("upload",function(t){var e=n.uploadImage||{};t.render({url:e.url,method:e.type,elem:d(a).find("input")[0],done:function(t){0==t.code?(t.data=t.data||{},b.call(l,"img",{src:t.data.src,alt:t.data.title},i)):u.msg(t.msg||"上传失败")}})})},code:function(e){L.call(r,function(t){b.call(l,"pre",{text:t.code,"lay-lang":t.lang},e)})},help:function(){u.open({type:2,title:"帮助",area:["600px","380px"],shadeClose:!0,shade:.1,skin:"layui-layer-msg",content:["http://www.layui.com/about/layedit/help.html","no"]})}},s=t.find(".layui-layedit-tool"),i=function(){var t=d(this),e=t.attr("layedit-event"),i=t.attr("lay-command");if(!t.hasClass(m)){r.focus();var a=h(o);a.commonAncestorContainer;i?(o.execCommand(i),/justifyLeft|justifyCenter|justifyRight/.test(i)&&o.execCommand("formatBlock",!1,"<p>"),setTimeout(function(){r.focus()},10)):c[e]&&c[e].call(this,a),x.call(l,s,t)}},a=/image/;s.find(">i").on("mousedown",function(){var t=d(this),e=t.attr("layedit-event");a.test(e)||i.call(this)}).on("click",function(){var t=d(this),e=t.attr("layedit-event");a.test(e)&&i.call(this)}),r.on("click",function(){x.call(l,s),u.close(w.index)})},C=function(t,a){var l=this,e=u.open({type:1,id:"LAY_layedit_link",area:"350px",shade:.05,shadeClose:!0,moveType:1,title:"超链接",skin:"layui-layer-msg",content:['<ul class="layui-form" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">URL</label>','<div class="layui-input-block" style="margin-left: 90px">','<input name="url" lay-verify="url" value="'+(t.href||"")+'" autofocus="true" autocomplete="off" class="layui-input">',"</div>","</li>",'<li class="layui-form-item">','<label class="layui-form-label" style="width: 60px;">打开方式</label>','<div class="layui-input-block" style="margin-left: 90px">','<input type="radio" name="target" value="_self" class="layui-input" title="当前窗口"'+("_self"!==t.target&&t.target?"":"checked")+">",'<input type="radio" name="target" value="_blank" class="layui-input" title="新窗口" '+("_blank"===t.target?"checked":"")+">","</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-link-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(t,e){var i="submit(layedit-link-yes)";n.render("radio"),t.find(".layui-btn-primary").on("click",function(){u.close(e),l.focus()}),n.on(i,function(t){u.close(C.index),a&&a(t.field)})}});C.index=e},w=function(i){var a=function(){var t=["[微笑]","[嘻嘻]","[哈哈]","[可爱]","[可怜]","[挖鼻]","[吃惊]","[害羞]","[挤眼]","[闭嘴]","[鄙视]","[爱你]","[泪]","[偷笑]","[亲亲]","[生病]","[太开心]","[白眼]","[右哼哼]","[左哼哼]","[嘘]","[衰]","[委屈]","[吐]","[哈欠]","[抱抱]","[怒]","[疑问]","[馋嘴]","[拜拜]","[思考]","[汗]","[困]","[睡]","[钱]","[失望]","[酷]","[色]","[哼]","[鼓掌]","[晕]","[悲伤]","[抓狂]","[黑线]","[阴险]","[怒骂]","[互粉]","[心]","[伤心]","[猪头]","[熊猫]","[兔子]","[ok]","[耶]","[good]","[NO]","[赞]","[来]","[弱]","[草泥马]","[神马]","[囧]","[浮云]","[给力]","[围观]","[威武]","[奥特曼]","[礼物]","[钟]","[话筒]","[蜡烛]","[蛋糕]"],i={};return layui.each(t,function(t,e){i[e]=layui.cache.dir+"images/face/"+t+".gif"}),i}();return w.hide=w.hide||function(t){"face"!==d(t.target).attr("layedit-event")&&u.close(w.index)},w.index=u.tips(function(){var i=[];return layui.each(a,function(t,e){i.push('<li title="'+t+'"><img src="'+e+'" alt="'+t+'"></li>')}),'<ul class="layui-clear">'+i.join("")+"</ul>"}(),this,{tips:1,time:0,skin:"layui-box layui-util-face",maxWidth:500,success:function(t,e){t.css({marginTop:-4,marginLeft:-10}).find(".layui-clear>li").on("click",function(){i&&i({src:a[this.title],alt:this.title}),u.close(e)}),d(document).off("click",w.hide).on("click",w.hide)}})},L=function(a){var l=this,t=u.open({type:1,id:"LAY_layedit_code",area:"550px",shade:.05,shadeClose:!0,moveType:1,title:"插入代码",skin:"layui-layer-msg",content:['<ul class="layui-form layui-form-pane" style="margin: 15px;">','<li class="layui-form-item">','<label class="layui-form-label">请选择语言</label>','<div class="layui-input-block">','<select name="lang">','<option value="JavaScript">JavaScript</option>','<option value="HTML">HTML</option>','<option value="CSS">CSS</option>','<option value="Java">Java</option>','<option value="PHP">PHP</option>','<option value="C#">C#</option>','<option value="Python">Python</option>','<option value="Ruby">Ruby</option>','<option value="Go">Go</option>',"</select>","</div>","</li>",'<li class="layui-form-item layui-form-text">','<label class="layui-form-label">代码</label>','<div class="layui-input-block">','<textarea name="code" lay-verify="required" autofocus="true" class="layui-textarea" style="height: 200px;"></textarea>',"</div>","</li>",'<li class="layui-form-item" style="text-align: center;">','<button type="button" lay-submit lay-filter="layedit-code-yes" class="layui-btn"> 确定 </button>','<button style="margin-left: 20px;" type="button" class="layui-btn layui-btn-primary"> 取消 </button>',"</li>","</ul>"].join(""),success:function(t,e){var i="submit(layedit-code-yes)";n.render("select"),t.find(".layui-btn-primary").on("click",function(){u.close(e),l.focus()}),n.on(i,function(t){u.close(L.index),a&&a(t.field)})}});L.index=t},T={html:'<i class="layui-icon layedit-tool-html" title="HTML源代码" lay-command="html" layedit-event="html"">&#xe64b;</i><span class="layedit-tool-mid"></span>',strong:'<i class="layui-icon layedit-tool-b" title="加粗" lay-command="Bold" layedit-event="b"">&#xe62b;</i>',italic:'<i class="layui-icon layedit-tool-i" title="斜体" lay-command="italic" layedit-event="i"">&#xe644;</i>',underline:'<i class="layui-icon layedit-tool-u" title="下划线" lay-command="underline" layedit-event="u"">&#xe646;</i>',del:'<i class="layui-icon layedit-tool-d" title="删除线" lay-command="strikeThrough" layedit-event="d"">&#xe64f;</i>',"|":'<span class="layedit-tool-mid"></span>',left:'<i class="layui-icon layedit-tool-left" title="左对齐" lay-command="justifyLeft" layedit-event="left"">&#xe649;</i>',center:'<i class="layui-icon layedit-tool-center" title="居中对齐" lay-command="justifyCenter" layedit-event="center"">&#xe647;</i>',right:'<i class="layui-icon layedit-tool-right" title="右对齐" lay-command="justifyRight" layedit-event="right"">&#xe648;</i>',link:'<i class="layui-icon layedit-tool-link" title="插入链接" layedit-event="link"">&#xe64c;</i>',unlink:'<i class="layui-icon layedit-tool-unlink layui-disabled" title="清除链接" lay-command="unlink" layedit-event="unlink"">&#xe64d;</i>',face:'<i class="layui-icon layedit-tool-face" title="表情" layedit-event="face"">&#xe650;</i>',image:'<i class="layui-icon layedit-tool-image" title="图片" layedit-event="image">&#xe64a;<input type="file" name="file"></i>',code:'<i class="layui-icon layedit-tool-code" title="插入代码" layedit-event="code">&#xe64e;</i>',help:'<i class="layui-icon layedit-tool-help" title="帮助" layedit-event="help">&#xe607;</i>'},r=new e;t(i,r)});